<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How Screwed Are You? â€” Tjek din energiregning</title>

    <!-- OG / Social Sharing -->
    <meta property="og:title" content="How Screwed Are You? â€” Tjek din energiregning">
    <meta property="og:description" content="Se hvor meget af din regning der faktisk er el â€” og hvor meget der er tariffer, afgifter og systemgebyrer.">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="description" content="Se hvor meget af din regning der faktisk er el â€” og hvor meget der er tariffer, afgifter og systemgebyrer. Tjek din Screwed Score nu.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- ============================================ -->
    <!-- FLOATING EMOJI BACKGROUND                     -->
    <!-- ============================================ -->
    <div class="emoji-bg" aria-hidden="true">
        <span class="emoji-float" style="top:8%;left:5%;animation-delay:0s;font-size:3rem;">âš¡</span>
        <span class="emoji-float" style="top:15%;right:10%;animation-delay:3s;font-size:2.5rem;">ğŸ’¸</span>
        <span class="emoji-float" style="top:35%;left:8%;animation-delay:7s;font-size:2rem;">ğŸ”Œ</span>
        <span class="emoji-float" style="top:55%;right:5%;animation-delay:2s;font-size:3.5rem;">ğŸ’¡</span>
        <span class="emoji-float" style="top:70%;left:12%;animation-delay:5s;font-size:2rem;">ğŸ </span>
        <span class="emoji-float" style="top:85%;right:15%;animation-delay:9s;font-size:2.5rem;">ğŸ”‹</span>
    </div>

    <!-- ============================================ -->
    <!-- SECTION 1: HERO                               -->
    <!-- ============================================ -->
    <section id="hero">
        <div class="hero-content">
            <div class="hero-badge">âš¡ Energi-transparens</div>
            <h1 class="hero-h1">
                <span class="word" style="--i:0">How</span>
                <span class="word" style="--i:1">Screwed</span>
                <span class="word" style="--i:2">Are</span>
                <span class="word" style="--i:3">You?</span>
            </h1>
            <p class="hero-sub">
                Se prÃ¦cis hvor dine energipenge gÃ¥r hen â€” og hvor meget der ikke behÃ¸ver at forlade din gade.
            </p>

            <div class="hero-form-card">
                <p class="form-lead">â±ï¸ Har du 30 sekunder?</p>
                <p class="form-desc">Indtast dit postnummer og ca. hvad du betaler om mÃ¥neden. Vi viser dig din Screwed Score med det samme.</p>
                <form id="score-form" class="score-form" autocomplete="off">
                    <div class="form-row">
                        <div class="input-group">
                            <label for="postcode">Postnummer</label>
                            <input type="text" id="postcode" name="postcode" placeholder="f.eks. 8000" maxlength="4" inputmode="numeric" pattern="[0-9]{4}" required>
                        </div>
                        <div class="input-group">
                            <label for="monthly-amount">Kr / mÃ¥ned</label>
                            <input type="text" id="monthly-amount" name="amount" placeholder="f.eks. 2500" inputmode="numeric" required>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary btn-pulse" id="check-score-btn">
                        Tjek Min Score â†’
                    </button>
                </form>
                <p class="form-micro">Ingen login. Ingen salgstale. Bare sandheden. ğŸ¤·</p>
            </div>

            <div class="hero-upload">
                <p class="upload-lead">ğŸ“„ Vil du have det prÃ¦cise tal?</p>
                <div class="upload-zone" id="upload-zone">
                    <span class="upload-icon">ğŸ“</span>
                    <p>Drop din regning her â€” vi nedbryder den linje for linje.</p>
                    <span class="upload-cta">Upload Min Regning</span>
                </div>
            </div>

            <div class="hero-social-proof">
                <div class="proof-avatars">
                    <span class="avatar">ğŸ§‘</span>
                    <span class="avatar">ğŸ‘©</span>
                    <span class="avatar">ğŸ§”</span>
                    <span class="avatar">ğŸ‘µ</span>
                </div>
                <span class="proof-text"><strong>2,847</strong> har allerede tjekket deres score</span>
            </div>
        </div>

        <div class="scroll-indicator" aria-hidden="true">
            <span>â†“</span>
        </div>
    </section>

    <!-- ============================================ -->
    <!-- SECTION 2: SCORE REVEAL (hidden initially)    -->
    <!-- ============================================ -->
    <div id="calculating-overlay" class="overlay hidden">
        <div class="calc-content">
            <div class="calc-icon">ğŸ“Š</div>
            <div class="calc-text" id="calc-text">Analyserer din regning...</div>
            <div class="calc-progress">
                <div class="calc-progress-bar" id="calc-progress-bar"></div>
            </div>
            <div class="calc-facts" id="calc-facts">
                <span>âš¡ Danmark producerer 55% af sin el fra vind</span>
            </div>
        </div>
    </div>

    <section id="score-reveal" class="hidden">
        <div class="score-card" id="score-card">
            <div class="score-card-glow" id="score-card-glow"></div>

            <div class="score-card-header">
                <span class="score-card-badge">âš¡ HOW SCREWED ARE YOU?</span>
            </div>

            <div class="score-card-body">
                <div class="score-number-wrap">
                    <span class="score-number" id="score-number">0.0</span>
                    <span class="score-divider">/ 10</span>
                </div>

                <div class="score-tier" id="score-tier">
                    <span class="tier-emoji" id="tier-emoji">ğŸ”¥</span>
                    <h2 class="tier-label" id="tier-label">Systemets Bedste Kunde</h2>
                    <p class="tier-sublabel" id="tier-sublabel">The System's Best Customer</p>
                </div>

                <div class="score-data-card">
                    <div class="donut-wrap">
                        <div class="donut" id="donut-chart">
                            <div class="donut-center">
                                <span class="donut-pct" id="donut-pct">22%</span>
                                <span class="donut-label">faktisk el</span>
                            </div>
                        </div>
                    </div>
                    <div class="data-text">
                        <p>Af dine <strong id="bill-total">2.847 kr</strong> om mÃ¥neden gÃ¥r ca. <strong id="bill-electricity" class="text-green">612 kr</strong> til faktisk el.</p>
                        <p>Resten? Tariffer, afgifter og systemgebyrer. ğŸ’¸</p>
                    </div>
                </div>

                <div class="score-comparison">
                    <div class="comparison-bar-wrap">
                        <div class="comparison-bar" id="comparison-bar"></div>
                        <div class="comparison-marker" id="comparison-marker">DU</div>
                    </div>
                    <p class="comparison-text" id="comparison-text">Du er mere skruet end <strong>84%</strong> af husstande i <strong>8000 Aarhus C</strong></p>
                </div>

                <div class="score-community-hint">
                    <p>I et energifÃ¦llesskab ville din score falde til ca. <strong class="text-green" id="community-score">2.1</strong> â˜€ï¸</p>
                </div>
            </div>

            <div class="score-card-actions">
                <button class="btn-share" id="share-btn">
                    <span>ğŸ“¤</span> Del Din Score
                </button>
                <p class="share-sub">Tror du dine naboer kender deres nummer?</p>
                <a href="#solution" class="btn-secondary-link">Se hvad du kan gÃ¸re â†’</a>
            </div>

            <div class="score-card-footer">
                <span>howscrewed.dk</span>
            </div>
        </div>

        <!-- Share toast -->
        <div class="share-toast hidden" id="share-toast">âœ… Kopieret til udklipsholder!</div>

        <div class="score-continue">
            <a href="#problem" class="scroll-link">Scroll for at forstÃ¥ din regning â†“</a>
        </div>
    </section>

    <!-- ============================================ -->
    <!-- SECTION 3: PROBLEM â€” "Your Bill Has a Story" -->
    <!-- ============================================ -->
    <section id="problem" class="section-dark">
        <div class="container narrow">
            <div class="scroll-animate">
                <span class="section-badge">ğŸ“„ Din regning</span>
                <h2 class="section-h2">Din Regning Har en Historie.<br>Du Kommer Ikke Til at Kunne Lide Den.</h2>
            </div>
            <div class="scroll-animate" style="--delay: 0.1s">
                <p class="body-text">Du betalte din elregning i sidste mÃ¥ned. TÃ¦nkte sikkert ikke sÃ¥ meget over det. Den kom, du betalte, du gik videre.</p>
                <p class="body-text">Her er hvad du betalte for:</p>
            </div>
        </div>

        <!-- Full-width bill breakdown bar -->
        <div class="bill-breakdown scroll-animate" style="--delay: 0.3s">
            <div class="bar-container">
                <div class="bar-segment" data-label="Nettarif" data-amount="798 kr" data-pct="28" style="--width:28%;--color:var(--electric-coral);">
                    <span class="bar-label">Nettarif</span>
                </div>
                <div class="bar-segment" data-label="Elafgift" data-amount="627 kr" data-pct="22" style="--width:22%;--color:var(--electric-amber);">
                    <span class="bar-label">Elafgift</span>
                </div>
                <div class="bar-segment" data-label="Systemtarif" data-amount="228 kr" data-pct="8" style="--width:8%;--color:var(--electric-purple);">
                    <span class="bar-label">Sys.</span>
                </div>
                <div class="bar-segment" data-label="Transmissionstarif" data-amount="171 kr" data-pct="6" style="--width:6%;--color:var(--electric-cyan);">
                    <span class="bar-label">Trans.</span>
                </div>
                <div class="bar-segment" data-label="Moms (25%)" data-amount="569 kr" data-pct="20" style="--width:20%;--color:var(--text-secondary);">
                    <span class="bar-label">Moms</span>
                </div>
                <div class="bar-segment segment-electricity" data-label="Faktisk Elektricitet âš¡" data-amount="454 kr" data-pct="16" style="--width:16%;--color:var(--electric-lime);">
                    <span class="bar-label">El âš¡</span>
                </div>
            </div>
            <div class="bar-tooltip hidden" id="bar-tooltip"></div>
            <p class="bar-caption scroll-animate" style="--delay: 0.5s">ğŸ‘† Den lille grÃ¸nne stump? Det er din faktiske elektricitet.</p>
        </div>

        <div class="container narrow">
            <div class="scroll-animate" style="--delay: 0.4s">
                <p class="body-text">For hver krone pÃ¥ din regning gik ca. <span class="highlight-coral">0,16 kr</span> til faktisk el. Resten? Nettarif. Systemtarif. Transmissionstarif. Elafgift. Moms. Lag pÃ¥ lag af omkostninger til et net du ikke ejer, styret af selskaber du ikke valgte, struktureret pÃ¥ mÃ¥der ingen nogensinde forklarede dig.</p>
            </div>
            <div class="scroll-animate" style="--delay: 0.5s">
                <p class="body-text">Det er ikke en konspiration. Ingen sidder og snor deres overskÃ¦g. Det er bare et system bygget til en anden tid â€” centraliserede kraftvÃ¦rker, langdistance-transmission, envejs-levering. Du modtager. Du betaler. Slut.</p>
                <p class="body-text">Bortset fra at det ikke behÃ¸ver at vÃ¦re slut. Fordi de danskere der kom fÃ¸r dig allerede lÃ¸ste det her problem Ã©n gang â€” de lÃ¸ste det bare for mejerier og vindmÃ¸ller i stedet for din elregning.</p>
            </div>
        </div>
    </section>

    <!-- ============================================ -->
    <!-- SECTION 4: THE SHIFT                          -->
    <!-- ============================================ -->
    <section id="the-shift">
        <div class="shift-gradient"></div>
        <div class="container narrow shift-content">
            <div class="scroll-animate">
                <span class="section-badge badge-light">ğŸ’¡ Forestil dig</span>
                <h2 class="section-h2 text-dark">Hvad Hvis Din Gade<br>Beholdt Hver Krone?</h2>
            </div>
            <div class="scroll-animate" style="--delay: 0.1s">
                <p class="body-text text-dark">Forestil dig det. De penge du bruger pÃ¥ el hver mÃ¥ned holder op med at strÃ¸mme gennem seks lag af infrastruktur og gebyrer. I stedet bliver de lige her. PÃ¥ din gade. Driver dine naboers huse. Under jeres kollektive kontrol.</p>
            </div>
            <div class="scroll-animate shift-key-line" style="--delay: 0.2s">
                <p class="big-statement">Du skifter ikke udbyder.<br><span class="statement-accent">Du BLIVER udbyderen.</span></p>
            </div>
            <div class="scroll-animate" style="--delay: 0.3s">
                <p class="body-text text-dark">Du og dine naboer. Sammen. Den samme model dine oldeforÃ¦ldre brugte da de byggede andelsmejerier. Den samme model der gjorde Danmark til verdensleder i vindenergi. Anvendt pÃ¥ det ene alle pÃ¥ din gade allerede betaler for.</p>
                <p class="body-text text-dark">Det hedder et <strong>EnergifÃ¦llesskab</strong>. Og det er ikke nyt â€” det er den Ã¦ldste idÃ© i Danmark, anvendt pÃ¥ et moderne problem. ğŸ¤</p>
            </div>
        </div>
    </section>

    <!-- ============================================ -->
    <!-- SECTION 5: SOLUTION                           -->
    <!-- ============================================ -->
    <section id="solution" class="section-light">
        <div class="container">
            <div class="scroll-animate">
                <span class="section-badge badge-green">ğŸ˜ï¸ EnergifÃ¦llesskaber</span>
                <h2 class="section-h2 text-dark">SÃ¥dan Fungerer Det</h2>
                <p class="section-sub text-dark">Et EnergifÃ¦llesskab er en juridisk anerkendt kooperativ struktur â€” defineret under EU-lovgivning, stÃ¸ttet af dansk regulering, bakket op af reel funding.</p>
            </div>

            <div class="solution-grid">
                <div class="solution-card scroll-animate" style="--delay: 0.1s">
                    <span class="card-emoji">â˜€ï¸</span>
                    <h3>FÃ¦lles Sol, FÃ¦lles Besparelser</h3>
                    <p>Din gade installerer produktion og lagring kollektivt. Den el I producerer forbliver lokal. Det virker fordi I skÃ¦rer mellemledene vÃ¦k.</p>
                </div>
                <div class="solution-card scroll-animate" style="--delay: 0.2s">
                    <span class="card-emoji">ğŸ </span>
                    <h3>Du BehÃ¸ver Ikke et Sydvendt Tag</h3>
                    <p>Det her er ikke individuelle solpaneler. Det er kollektiv infrastruktur. Lejere, beboere i lejligheder â€” alle pÃ¥ gaden deltager. Andelsmodellen er bygget til at inkludere alle.</p>
                </div>
                <div class="solution-card scroll-animate" style="--delay: 0.3s">
                    <span class="card-emoji">ğŸ’°</span>
                    <h3>Pengene Findes Allerede</h3>
                    <p>EU og den danske stat har Ã¸remÃ¦rket milliarder til borger-energiinitiativer. De fleste ved ikke pengene ligger der. De er specifikt til at hjÃ¦lpe fÃ¦llesskaber som dit med at komme i gang.</p>
                </div>
                <div class="solution-card scroll-animate" style="--delay: 0.4s">
                    <span class="card-emoji">ğŸ¤</span>
                    <h3>I Bestemmer Selv</h3>
                    <p>Ingen eksterne aktionÃ¦rer. Intet moderselskab. Jeres fÃ¦llesskab sÃ¦tter reglerne, deler besparelserne og ejer infrastrukturen. Ligesom en andelsboligforening â€” bare for el.</p>
                </div>
            </div>

            <div class="diff-block scroll-animate" style="--delay: 0.5s">
                <h3 class="diff-title">Det Her Er Ikke "Skift og Spar." Det Er Ejerskab.</h3>
                <div class="diff-items">
                    <div class="diff-item">
                        <span class="diff-icon">ğŸ“Š</span>
                        <p><strong>Et udbyderskift sparer dig Ã¸re. Ejerskab sparer dig hele marginen.</strong> NÃ¥r dit fÃ¦llesskab producerer sin egen el, begynder nettarif og mellemledsomkostninger at skrumpe.</p>
                    </div>
                    <div class="diff-item">
                        <span class="diff-icon">ğŸ‡©ğŸ‡°</span>
                        <p><strong>Danmark har allerede bevist det virker.</strong> Andelsmejerier. VindmÃ¸llelaug. Fjernvarmeselskaber. EnergifÃ¦llesskaber er nÃ¦ste kapitel af den samme historie.</p>
                    </div>
                    <div class="diff-item">
                        <span class="diff-icon">ğŸ‡ªğŸ‡º</span>
                        <p><strong>EU satser pÃ¥ det â€” med penge.</strong> Direktiv 2019/944 og RED II tillader ikke bare EnergifÃ¦llesskaber. De finansierer dem.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ============================================ -->
    <!-- SECTION 6: SOCIAL PROOF                       -->
    <!-- ============================================ -->
    <section id="social-proof" class="section-surface">
        <div class="container">
            <div class="scroll-animate">
                <span class="section-badge">ğŸ“¢ Det sker allerede</span>
                <h2 class="section-h2">Det Sker Allerede</h2>
            </div>

            <div class="testimonials">
                <div class="testimonial-card scroll-animate" style="--delay: 0.1s">
                    <div class="quote-mark">"</div>
                    <p class="quote-text">Vi startede med 14 husstande. Processen tog ca. 8 mÃ¥neder. Vores elomkostninger faldt med 34% â€” men det bedste er at vide pengene bliver i vores fÃ¦llesskab.</p>
                    <div class="quote-author">
                        <span class="author-avatar">ğŸ§‘â€ğŸŒ¾</span>
                        <div>
                            <strong>Anders M.</strong>
                            <span>SÃ¸nderborg, Danmark</span>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card scroll-animate" style="--delay: 0.2s">
                    <div class="quote-mark">"</div>
                    <p class="quote-text">Jeg tjekkede min score en tirsdag aften af nysgerrighed. Torsdag havde jeg sendt linket til alle pÃ¥ min gade. Det viste sig vi alle var stille irriterede over det samme.</p>
                    <div class="quote-author">
                        <span class="author-avatar">ğŸ‘©â€ğŸ’»</span>
                        <div>
                            <strong>Mette K.</strong>
                            <span>Aarhus, Danmark</span>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card scroll-animate" style="--delay: 0.3s">
                    <div class="quote-mark">"</div>
                    <p class="quote-text">Jeg lejer. Jeg antog det ikke var for mig. Det er det.</p>
                    <div class="quote-author">
                        <span class="author-avatar">ğŸ§”</span>
                        <div>
                            <strong>Kasper L.</strong>
                            <span>KÃ¸benhavn, Danmark</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card scroll-animate" style="--delay: 0.1s">
                    <span class="stat-number counter" data-target="2847">0</span>
                    <span class="stat-label">har tjekket deres score</span>
                </div>
                <div class="stat-card scroll-animate" style="--delay: 0.2s">
                    <span class="stat-number counter" data-target="12">0</span>
                    <span class="stat-label">energifÃ¦llesskaber startet</span>
                </div>
                <div class="stat-card scroll-animate" style="--delay: 0.3s">
                    <span class="stat-number"><span class="counter" data-target="34">0</span>%</span>
                    <span class="stat-label">gns. reduktion i elomkostninger</span>
                </div>
                <div class="stat-card scroll-animate" style="--delay: 0.4s">
                    <span class="stat-number"><span class="counter" data-target="3">0</span> mia.</span>
                    <span class="stat-label">DKK tilgÃ¦ngelig EU/national funding</span>
                </div>
            </div>
        </div>
    </section>

    <!-- ============================================ -->
    <!-- SECTION 7: FINAL CTA                          -->
    <!-- ============================================ -->
    <section id="final-cta" class="section-dark">
        <div class="final-glow"></div>
        <div class="container narrow final-content">
            <div class="scroll-animate">
                <h2 class="final-h2">Dine BedsteforÃ¦ldre Byggede Andelsforeninger.<br><span class="final-accent">Nu Er Det Din Tur.</span></h2>
            </div>
            <div class="scroll-animate" style="--delay: 0.1s">
                <p class="body-text final-body">Andelsmodellen byggede dansk landbrug. Den byggede dansk vindenergi. Den byggede de andelsboliger halvdelen af KÃ¸benhavn bor i. Hver gang var idÃ©en den samme: hvorfor betale en anden nÃ¥r I kan eje det sammen?</p>
                <p class="body-text final-body">Din elregning er den sidste bastion. Lovgrundlaget er klar. Pengene venter. FÃ¦llesskaber dannes allerede.</p>
                <p class="body-text final-body">Det eneste spÃ¸rgsmÃ¥l er om din gade starter nu â€” eller venter til en andens gÃ¸r. ğŸš€</p>
            </div>

            <div class="final-form-card scroll-animate" style="--delay: 0.2s">
                <h3>Se Hvor Dine Penge Faktisk GÃ¥r Hen</h3>
                <p>Din Screwed Score tager 30 sekunder. Den kan Ã¦ndre hvordan du tÃ¦nker pÃ¥ din elregning â€” permanent.</p>
                <form id="score-form-bottom" class="score-form" autocomplete="off">
                    <div class="form-row">
                        <div class="input-group">
                            <label for="postcode-bottom">Postnummer</label>
                            <input type="text" id="postcode-bottom" name="postcode" placeholder="f.eks. 8000" maxlength="4" inputmode="numeric" pattern="[0-9]{4}" required>
                        </div>
                        <div class="input-group">
                            <label for="amount-bottom">Kr / mÃ¥ned</label>
                            <input type="text" id="amount-bottom" name="amount" placeholder="f.eks. 2500" inputmode="numeric" required>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary btn-pulse">
                        Tjek Min Score â†’
                    </button>
                </form>
                <p class="form-micro">Ingen tilmelding. Ingen salgstale. Bare dine tal. âœ¨</p>
            </div>
        </div>
    </section>

    <!-- ============================================ -->
    <!-- SECTION 8: REFERRED FRIEND (hidden by default) -->
    <!-- ============================================ -->
    <section id="referred" class="hidden">
        <div class="referred-content">
            <div class="referred-badge">âš¡ HOW SCREWED ARE YOU?</div>
            <div class="referred-hook">
                <p class="referred-score">Din nabo scorede <strong id="ref-score">7.8</strong> ud af 10.</p>
                <p class="referred-tier">De er "<strong id="ref-tier">Systemets Bedste Kunde</strong>." ğŸ”¥</p>
            </div>
            <h1 class="referred-h1">Hvor skruet er du?</h1>
            <form id="score-form-referred" class="score-form" autocomplete="off">
                <div class="form-row">
                    <div class="input-group">
                        <label for="postcode-ref">Postnummer</label>
                        <input type="text" id="postcode-ref" name="postcode" placeholder="f.eks. 8000" maxlength="4" inputmode="numeric" pattern="[0-9]{4}" required>
                    </div>
                    <div class="input-group">
                        <label for="amount-ref">Kr / mÃ¥ned</label>
                        <input type="text" id="amount-ref" name="amount" placeholder="f.eks. 2500" inputmode="numeric" required>
                    </div>
                </div>
                <button type="submit" class="btn-primary btn-pulse">
                    Tjek Min Score â†’
                </button>
            </form>
            <p class="referred-activity"><span id="ref-activity-count">47</span> personer i dit omrÃ¥de har tjekket de seneste 24 timer</p>
        </div>
    </section>

    <!-- ============================================ -->
    <!-- FOOTER                                        -->
    <!-- ============================================ -->
    <footer class="site-footer">
        <div class="container footer-inner">
            <span class="footer-brand">âš¡ How Screwed Are You? â€” et projekt af <strong>Orklys</strong></span>
            <span class="footer-links">
                <a href="#">Om Orklys</a>
                <a href="#">Privatlivspolitik</a>
            </span>
        </div>
    </footer>


    <!-- ============================================ -->
    <!-- JAVASCRIPT                                    -->
    <!-- ============================================ -->
    <script>
    // ===== STATE =====
    let userScore = null;
    let userPostcode = '';
    let userAmount = 0;
    let referrerScore = null;

    const TIERS = [
        { min: 8, label: 'Systemets Bedste Kunde', sub: "The System's Best Customer", emoji: 'ğŸ”¥ğŸ’€', colorStart: '#FF6B6B', colorEnd: '#FF3E3E' },
        { min: 6, label: 'Stille Betaler', sub: 'The Quiet Payer', emoji: 'ğŸ‘€ğŸ’¸', colorStart: '#FFB347', colorEnd: '#FF8C42' },
        { min: 4, label: 'Mildt Irriteret', sub: 'Mildly Annoyed', emoji: 'ğŸ˜’ğŸ¤·', colorStart: '#FFD93D', colorEnd: '#FFB347' },
        { min: 2, label: 'Nogenlunde', sub: 'Getting By', emoji: 'ğŸ‘ğŸ˜', colorStart: '#4ECDC4', colorEnd: '#44A08D' },
        { min: 0, label: 'NÃ¦sten Fri', sub: 'Almost Free', emoji: 'ğŸ¤©ğŸ‰', colorStart: '#A8E06C', colorEnd: '#6BCB77' }
    ];

    const CALC_MESSAGES = [
        'âš¡ Analyserer din regning...',
        'ğŸ“Š Finder dine tariffer...',
        'ğŸ” Tjekker nettarif og systemtarif...',
        'ğŸ§® Beregner din score...',
        'ğŸ‡©ğŸ‡° Sammenligner med dit omrÃ¥de...'
    ];

    const FUN_FACTS = [
        'âš¡ Danmark producerer 55% af sin el fra vind',
        'ğŸ’¸ Den gennemsnitlige danske husstand betaler 2.847 kr/md for el',
        'ğŸ“„ Kun ca. 16-22% af din regning er faktisk el',
        'ğŸ˜ï¸ Over 3.500 energifÃ¦llesskaber eksisterer allerede i EU',
        'ğŸ¤ Den danske andelsmodel er 150 Ã¥r gammel'
    ];

    // ===== INIT =====
    document.addEventListener('DOMContentLoaded', () => {
        checkReferralParam();
        initScrollAnimations();
        initFormHandlers();
        initBillBreakdown();
        initCounterAnimations();
        initSmoothScroll();
    });

    // ===== REFERRAL =====
    function checkReferralParam() {
        const params = new URLSearchParams(window.location.search);
        const ref = params.get('ref');
        if (ref) {
            referrerScore = parseFloat(ref);
            if (!isNaN(referrerScore) && referrerScore >= 0 && referrerScore <= 10) {
                showReferredPage(referrerScore);
            }
        }
    }

    function showReferredPage(score) {
        // Hide everything except referred section
        document.getElementById('hero').classList.add('hidden');
        document.querySelectorAll('.emoji-bg, .site-footer').forEach(el => el.style.display = 'none');
        document.querySelectorAll('#problem, #the-shift, #solution, #social-proof, #final-cta').forEach(el => el.classList.add('hidden'));

        const tier = getTier(score);
        document.getElementById('ref-score').textContent = score.toFixed(1);
        document.getElementById('ref-tier').textContent = tier.label;
        document.getElementById('ref-activity-count').textContent = Math.floor(Math.random() * 80) + 20;

        document.getElementById('referred').classList.remove('hidden');
    }

    // ===== SCORE CALCULATION =====
    function calculateScrewedScore(monthlyBill, postcode) {
        const avgBill = 2500;
        const electricityRatio = 0.20; // ~20% is actual electricity

        let baseScore = (1 - electricityRatio) * 10; // ~8.0

        // Bill amount factor
        let billFactor = (Math.min(monthlyBill / avgBill, 2.5) - 1) * 0.8;

        // Regional variation from postcode
        let regionPrefix = parseInt(postcode.substring(0, 2)) || 50;
        let regionFactor = ((regionPrefix % 7) - 3) * 0.12;

        let score = baseScore + billFactor + regionFactor;
        score = Math.min(9.8, Math.max(2.5, score));
        return Math.round(score * 10) / 10;
    }

    function getTier(score) {
        return TIERS.find(t => score >= t.min) || TIERS[TIERS.length - 1];
    }

    function getElectricityBreakdown(monthlyBill) {
        const electricityPct = 0.16 + Math.random() * 0.08; // 16-24%
        const electricityAmount = Math.round(monthlyBill * electricityPct);
        return { pct: Math.round(electricityPct * 100), amount: electricityAmount };
    }

    function getComparisonPercentile(score) {
        // Higher score = more screwed = higher percentile
        return Math.min(97, Math.max(45, Math.round(score * 10.5 + Math.random() * 5)));
    }

    // ===== FORM HANDLING =====
    function initFormHandlers() {
        const forms = ['score-form', 'score-form-bottom', 'score-form-referred'];
        forms.forEach(formId => {
            const form = document.getElementById(formId);
            if (form) {
                form.addEventListener('submit', handleScoreSubmit);
            }
        });
    }

    function handleScoreSubmit(e) {
        e.preventDefault();
        const form = e.target;
        const postcodeInput = form.querySelector('[name="postcode"]');
        const amountInput = form.querySelector('[name="amount"]');

        const postcode = postcodeInput.value.trim();
        const amount = parseInt(amountInput.value.replace(/\D/g, ''));

        if (!/^\d{4}$/.test(postcode)) {
            postcodeInput.classList.add('input-error');
            setTimeout(() => postcodeInput.classList.remove('input-error'), 1500);
            return;
        }
        if (!amount || amount < 100 || amount > 50000) {
            amountInput.classList.add('input-error');
            setTimeout(() => amountInput.classList.remove('input-error'), 1500);
            return;
        }

        userPostcode = postcode;
        userAmount = amount;
        userScore = calculateScrewedScore(amount, postcode);

        showCalculatingState();
    }

    // ===== CALCULATING ANIMATION =====
    function showCalculatingState() {
        const overlay = document.getElementById('calculating-overlay');
        const progressBar = document.getElementById('calc-progress-bar');
        const calcText = document.getElementById('calc-text');
        const calcFacts = document.getElementById('calc-facts');

        overlay.classList.remove('hidden');
        document.body.style.overflow = 'hidden';

        // Animate progress bar
        progressBar.style.width = '0%';
        requestAnimationFrame(() => {
            progressBar.style.transition = 'width 2.8s cubic-bezier(0.16, 1, 0.3, 1)';
            progressBar.style.width = '100%';
        });

        // Cycle through messages
        let msgIndex = 0;
        const msgInterval = setInterval(() => {
            msgIndex++;
            if (msgIndex < CALC_MESSAGES.length) {
                calcText.style.opacity = '0';
                setTimeout(() => {
                    calcText.textContent = CALC_MESSAGES[msgIndex];
                    calcText.style.opacity = '1';
                }, 200);
            }
        }, 550);

        // Show fun facts
        let factIndex = 0;
        const factInterval = setInterval(() => {
            factIndex = (factIndex + 1) % FUN_FACTS.length;
            calcFacts.style.opacity = '0';
            setTimeout(() => {
                calcFacts.innerHTML = `<span>${FUN_FACTS[factIndex]}</span>`;
                calcFacts.style.opacity = '1';
            }, 200);
        }, 1200);

        // After delay, show the score
        setTimeout(() => {
            clearInterval(msgInterval);
            clearInterval(factInterval);
            overlay.classList.add('hidden');
            document.body.style.overflow = '';
            showScoreReveal();
        }, 3000);
    }

    // ===== SCORE REVEAL =====
    function showScoreReveal() {
        const section = document.getElementById('score-reveal');
        const scoreEl = document.getElementById('score-number');
        const tier = getTier(userScore);
        const breakdown = getElectricityBreakdown(userAmount);
        const percentile = getComparisonPercentile(userScore);
        const communityScore = Math.round((userScore * 0.27 + Math.random() * 0.5) * 10) / 10;

        // Hide other sections, show score
        document.getElementById('hero').style.display = 'none';
        section.classList.remove('hidden');
        window.scrollTo({ top: 0, behavior: 'instant' });

        // Set tier colors
        const card = document.getElementById('score-card');
        const glow = document.getElementById('score-card-glow');
        card.style.setProperty('--tier-start', tier.colorStart);
        card.style.setProperty('--tier-end', tier.colorEnd);
        glow.style.background = `radial-gradient(ellipse at center, ${tier.colorStart}33 0%, transparent 70%)`;

        // Set data
        document.getElementById('tier-emoji').textContent = tier.emoji;
        document.getElementById('tier-label').textContent = tier.label;
        document.getElementById('tier-sublabel').textContent = tier.sub;
        document.getElementById('bill-total').textContent = userAmount.toLocaleString('da-DK') + ' kr';
        document.getElementById('bill-electricity').textContent = breakdown.amount + ' kr';
        document.getElementById('donut-pct').textContent = breakdown.pct + '%';
        document.getElementById('comparison-text').innerHTML = `Du er mere skruet end <strong>${percentile}%</strong> af husstande i <strong>${userPostcode}</strong>`;
        document.getElementById('community-score').textContent = communityScore.toFixed(1);

        // Animate score number counting
        animateScoreCounter(scoreEl, userScore, 2000);

        // Animate donut chart
        setTimeout(() => {
            const donut = document.getElementById('donut-chart');
            const feePct = 100 - breakdown.pct;
            donut.style.background = `conic-gradient(
                ${tier.colorStart} 0% ${feePct}%,
                var(--electric-lime) ${feePct}% 100%
            )`;
        }, 500);

        // Animate comparison bar
        setTimeout(() => {
            document.getElementById('comparison-bar').style.width = percentile + '%';
            document.getElementById('comparison-marker').style.left = percentile + '%';
        }, 1500);

        // Show remaining page sections
        setTimeout(() => {
            document.querySelectorAll('#problem, #the-shift, #solution, #social-proof, #final-cta, .site-footer').forEach(el => {
                el.classList.remove('hidden');
            });
        }, 2000);

        // Init share button
        initShareButton(userScore, tier);
    }

    function animateScoreCounter(element, target, duration) {
        const start = performance.now();
        const from = 0;

        function update(now) {
            const elapsed = now - start;
            const progress = Math.min(elapsed / duration, 1);
            // Ease out cubic
            const eased = 1 - Math.pow(1 - progress, 3);
            const current = from + (target - from) * eased;
            element.textContent = current.toFixed(1);

            // Update gradient based on current value
            const tier = getTier(current);
            element.style.background = `linear-gradient(135deg, ${tier.colorStart}, ${tier.colorEnd})`;
            element.style.webkitBackgroundClip = 'text';
            element.style.webkitTextFillColor = 'transparent';
            element.style.backgroundClip = 'text';

            if (progress < 1) {
                requestAnimationFrame(update);
            } else {
                // Final pop
                element.classList.add('score-pop');
                setTimeout(() => element.classList.remove('score-pop'), 600);
            }
        }

        requestAnimationFrame(update);
    }

    // ===== SHARING =====
    function initShareButton(score, tier) {
        const btn = document.getElementById('share-btn');
        btn.addEventListener('click', async () => {
            const shareText = `Min Screwed Score er ${score.toFixed(1)}/10 â€” Jeg er "${tier.label}." ğŸ”¥ Tjek din egen â†’ `;
            const shareUrl = window.location.origin + window.location.pathname + '?ref=' + score.toFixed(1);

            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'How Screwed Are You?',
                        text: shareText,
                        url: shareUrl
                    });
                } catch (err) {
                    // User cancelled share
                }
            } else {
                // Clipboard fallback
                try {
                    await navigator.clipboard.writeText(shareText + shareUrl);
                    showShareToast();
                } catch {
                    // Final fallback
                    const textarea = document.createElement('textarea');
                    textarea.value = shareText + shareUrl;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    showShareToast();
                }
            }
        });
    }

    function showShareToast() {
        const toast = document.getElementById('share-toast');
        toast.classList.remove('hidden');
        setTimeout(() => toast.classList.add('hidden'), 2500);
    }

    // ===== SCROLL ANIMATIONS =====
    function initScrollAnimations() {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate-in');
                }
            });
        }, { threshold: 0.15, rootMargin: '0px 0px -40px 0px' });

        document.querySelectorAll('.scroll-animate').forEach(el => observer.observe(el));
    }

    // ===== BILL BREAKDOWN INTERACTIVITY =====
    function initBillBreakdown() {
        const tooltip = document.getElementById('bar-tooltip');
        const segments = document.querySelectorAll('.bar-segment');

        segments.forEach(seg => {
            seg.addEventListener('mouseenter', (e) => {
                const label = seg.dataset.label;
                const amount = seg.dataset.amount;
                const pct = seg.dataset.pct;
                tooltip.innerHTML = `<strong>${label}</strong><br>${amount} (${pct}%)`;
                tooltip.classList.remove('hidden');
                positionTooltip(e, tooltip);
            });

            seg.addEventListener('mousemove', (e) => positionTooltip(e, tooltip));
            seg.addEventListener('mouseleave', () => tooltip.classList.add('hidden'));

            // Touch support
            seg.addEventListener('touchstart', (e) => {
                const label = seg.dataset.label;
                const amount = seg.dataset.amount;
                const pct = seg.dataset.pct;
                tooltip.innerHTML = `<strong>${label}</strong><br>${amount} (${pct}%)`;
                tooltip.classList.remove('hidden');
                const rect = seg.getBoundingClientRect();
                tooltip.style.left = rect.left + rect.width / 2 + 'px';
                tooltip.style.top = rect.top - 60 + 'px';
            });
        });

        document.addEventListener('touchstart', (e) => {
            if (!e.target.closest('.bar-segment')) {
                tooltip.classList.add('hidden');
            }
        });
    }

    function positionTooltip(e, tooltip) {
        tooltip.style.left = e.clientX + 'px';
        tooltip.style.top = (e.clientY - 60) + 'px';
    }

    // ===== COUNTER ANIMATIONS =====
    function initCounterAnimations() {
        const counters = document.querySelectorAll('.counter');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !entry.target.dataset.animated) {
                    entry.target.dataset.animated = 'true';
                    animateCounter(entry.target);
                }
            });
        }, { threshold: 0.5 });

        counters.forEach(c => observer.observe(c));
    }

    function animateCounter(el) {
        const target = parseInt(el.dataset.target);
        const duration = 1500;
        const start = performance.now();

        function update(now) {
            const elapsed = now - start;
            const progress = Math.min(elapsed / duration, 1);
            const eased = 1 - Math.pow(1 - progress, 3);
            el.textContent = Math.round(target * eased).toLocaleString('da-DK');
            if (progress < 1) requestAnimationFrame(update);
        }

        requestAnimationFrame(update);
    }

    // ===== SMOOTH SCROLL =====
    function initSmoothScroll() {
        document.querySelectorAll('a[href^="#"]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const target = document.querySelector(link.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
    }
    </script>
</body>
</html>
